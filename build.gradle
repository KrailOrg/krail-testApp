buildscript {
    repositories {
        mavenLocal()
        jcenter()
        mavenCentral()
    }

    dependencies {
        classpath 'com.bmuschko:gradle-tomcat-plugin:2.3'
    }
}

class Pause extends DefaultTask {
    int delaySecs = 5

    @TaskAction
    void pause() {

        int i = delaySecs
        while (i >= 1) {
            println "${i} seconnds left"
            i--
            Thread.sleep(1000)
        }
    }
}

plugins {
    id 'fi.jasoft.plugin.vaadin' version '1.1.6'
}


apply plugin: 'maven'
apply plugin: 'maven-publish'
apply plugin: 'java'
apply plugin: 'eclipse-wtp'
apply plugin: 'idea'
//apply from: 'http://plugins.jasoft.fi/vaadin-groovy.plugin?version=0.10.6'
apply plugin: 'com.bmuschko.tomcat'

description = 'Functional test application for Krail and its additional modules'

group = 'uk.q3c.krail'
version = '0.9.0'
//version = versionFromFile(project.projectDir)
ext.vaadinVersion = '7.6.3'

//vaadin {
//    widgetset "uk.q3c.krail.testapp.widgetset.testAppWidgetset"
//}

repositories {
    jcenter()
    mavenCentral()
    mavenLocal()
}

tomcat {
    httpProtocol = 'org.apache.coyote.http11.Http11Nio2Protocol'
    ajpProtocol = 'org.apache.coyote.ajp.AjpNio2Protocol'
}


dependencies {

    def tomcatVersion = '8.5.16'
    tomcat "org.apache.tomcat.embed:tomcat-embed-core:${tomcatVersion}",
            "org.apache.tomcat.embed:tomcat-embed-logging-juli:8.5.2",
            "org.apache.tomcat.embed:tomcat-embed-jasper:${tomcatVersion}"

    //Krail
    compile 'uk.q3c.krail:krail-jpa:0.9.3'

    //UI components
    compile 'de.steinwedel.vaadin.addon:messagebox:2.0.7'
    compile 'org.vaadin.addons:stepper:2.2.1'
    // Missing from stepper
    compile 'org.json:json:20141113'
    //vaadin push
//    compile 'com.vaadin:vaadin-push:' + vaadinVersion

    testCompile 'junit:junit:4.12'
    testCompile 'uk.q3c.krail:krail-bench:0.9.0.0.23599ef'
//    testCompile project(':krail-orient')


}

vaadin.logToConsole = true

ext.warName = (project.name.toLowerCase() + '.war')
war {
    exclude 'WEB-INF/lib/*'
    archiveName = warName
}

task copyWar(type: Copy) {
    dependsOn war
    File userHome = new File(System.getProperty('user.home'))
    File source = new File(project.buildDir, "libs")
    File dest = new File(userHome, "tomcat8.5/webapps")
    println ">>>>>>>>>>>>>>>>>>>>>>>>>>> from: ${source} to ${dest}"
    from source
    into dest
}

task pauseForApp(type: Pause){
    delaySecs =20
    dependsOn copyWar
}



test.dependsOn pauseForApp



vaadin {
    version vaadinVersion
//    manageWidgetset true
//    serverPort 8001
}



task wrapper(type: Wrapper) {
    gradleVersion = '4.0.1'
}

