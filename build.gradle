/*
 *
 *  * Copyright (c) 2016. David Sowerby
 *  *
 *  * Licensed under the Apache License, Version 2.0 (the "License"); you may not use this file except in compliance with
 *  * the License. You may obtain a copy of the License at http://www.apache.org/licenses/LICENSE-2.0
 *  *
 *  * Unless required by applicable law or agreed to in writing, software distributed under the License is distributed on
 *  * an "AS IS" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied. See the License for the
 *  * specific language governing permissions and limitations under the License.
 *
 */

buildscript {
    repositories {
        mavenLocal()
        jcenter()
    }

    dependencies {
//        classpath 'commons-io:commons-io:2.4'
        classpath 'com.bmuschko:gradle-docker-plugin:3.0.12'
    }
}

plugins {
    id 'fi.jasoft.plugin.vaadin' version '1.0.1'
}


apply plugin: 'maven'
apply plugin: 'maven-publish'
apply plugin: 'java'
apply plugin: 'eclipse-wtp'
apply plugin: 'idea'
//apply from: 'http://plugins.jasoft.fi/vaadin-groovy.plugin?version=0.10.6'
apply plugin: 'com.bmuschko.docker-remote-api'

description = 'Functional test application for Krail and its additional modules'

group = 'uk.q3c.krail'
version = '0.9.0'
//version = versionFromFile(project.projectDir)
ext.vaadinVersion = '7.6.3'

vaadin {
    widgetset "uk.q3c.krail.testapp.widgetset.testAppWidgetset"
}

repositories {
    jcenter()
    mavenCentral()
    mavenLocal()
}




dependencies {

    //Krail
    compile 'uk.q3c.krail:krail-jpa:0.9.3'

    //UI components
    compile 'de.steinwedel.vaadin.addon:messagebox:2.0.7'
    compile 'org.vaadin.addons:stepper:2.2.1'
    // Missing from stepper
    compile 'org.json:json:20141113'
    //vaadin push
//    compile 'com.vaadin:vaadin-push:' + vaadinVersion

    testCompile 'junit:junit:4.12'
    testCompile 'uk.q3c.krail:krail-bench:0.8.4'
//    testCompile project(':krail-orient')


}

vaadin.plugin.logToConsole = true

ext.warName = (project.name.toLowerCase() + '.war')
war {
    exclude 'WEB-INF/lib/*'
    archiveName = warName
}


//task createDockerfile(type: Dockerfile) {
//    dependsOn war
//    destFile = project.file('build/Dockerfile')
//    from "tomcat:8-jre8"
////    copy krail-testapp* /usr/local/tomcat/webapps/krail-testapp.war
//}
//
//task buildImage(type: DockerBuildImage) {
//    dependsOn createDockerfile
//    inputDir = createDockerfile.destFile.parentFile
//    tag = 'dsowerby/krail-testapp'
//}
//
//task createContainer(type: DockerCreateContainer) {
//    dependsOn buildImage
//    targetImageId { buildImage.getImageId() }
//    portBindings = ['8080:8080']
//}
//
//test.dependsOn(startContainer)
//test.finalizedBy(stopContainer)


vaadin {
    version vaadinVersion
    manageWidgetset true
//    serverPort 8001
}

task wrapper(type: Wrapper) {
    gradleVersion = '4.0.1'
}

